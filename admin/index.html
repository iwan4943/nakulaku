<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#F6F5F4" id="theme-color-meta">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>NAKULAKU ADMIN</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/iwan4943/nakulaku/refs/heads/main/admin/nkladm.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: { 
                extend: { 
                    colors: { 
                        nakula: { 50: '#fff1f2', 100: '#ffe4e6', 200: '#fecdd3', 500: '#f43f5e', 600: '#B3261E', 700: '#9f1239', 800: '#881337', 900: '#4c0519' },
                        gnomebg: '#F6F5F4', gnomecard: '#FFFFFF', 
                        darkbg: '#1E1E1E', darkcard: '#303030', darkborder: '#454545'
                    }, 
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    boxShadow: { 
                        'gnome': '0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02)', 
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.15)',
                        'dark-soft': '0 4px 12px rgba(0, 0, 0, 0.2)' 
                    },
                    animation: { 'fade-in': 'fadeIn 0.6s ease-out forwards', 'pulse-slow': 'pulse 3s infinite' },
                    keyframes: { fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                } 
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { -webkit-tap-highlight-color: transparent; touch-action: manipulation; user-select: none; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        @media (min-width: 1024px) { ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; } .dark ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); } }
        .bento-card { transition: transform 0.2s cubic-bezier(0.25, 0.1, 0.25, 1), background-color 0.2s; border: 1px solid rgba(0,0,0,0.05); }
        .dark .bento-card { border: 1px solid #454545; background-color: #303030; }
        .bento-card:active { transform: scale(0.98); }
        .icon-watermark { position: absolute; right: -20px; bottom: -20px; opacity: 0.03; transform: rotate(-15deg); transition: transform 0.3s; pointer-events: none; }
        .bento-card:hover .icon-watermark { transform: rotate(0deg) scale(1.2); opacity: 0.06; }
        .modal-content { transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1); }
        
        /* Slideshow Styles */
        .school-slide { position: absolute; inset: 0; display: flex; align-items: center; gap: 1rem; padding: 1.5rem; opacity: 0; transform: translateY(20px) scale(0.95); transition: all 1.5s cubic-bezier(0.2, 0.8, 0.2, 1); pointer-events: none; }
        .school-slide.active { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .school-slide.exit { opacity: 0; transform: translateY(-20px) scale(1.05); }

        /* Loader Style */
        .loader-ring { display: inline-block; position: relative; width: 80px; height: 80px; }
        .loader-ring div { box-sizing: border-box; display: block; position: absolute; width: 64px; height: 64px; margin: 8px; border: 4px solid #B3261E; border-radius: 50%; animation: loader-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite; border-color: #B3261E transparent transparent transparent; }
        .dark .loader-ring div { border-color: #fff transparent transparent transparent; }
        .loader-ring div:nth-child(1) { animation-delay: -0.45s; } .loader-ring div:nth-child(2) { animation-delay: -0.3s; } .loader-ring div:nth-child(3) { animation-delay: -0.15s; }
        @keyframes loader-ring { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gnomebg text-stone-800 dark:bg-darkbg dark:text-stone-200 h-screen flex flex-col relative transition-colors duration-300">

    <div class="fixed top-0 inset-x-0 h-48 bg-stone-200/30 dark:hidden pointer-events-none"></div>

    <main class="flex-1 flex flex-col h-full relative z-10 w-full md:flex-row md:overflow-hidden">
        
        <aside class="hidden md:flex w-20 xl:w-72 flex-col border-r border-stone-200 dark:border-darkborder bg-white/80 dark:bg-darkcard/80 backdrop-blur-md h-full p-4 xl:p-6 gap-6 z-20 shrink-0 transition-all duration-300">
            <div id="desktop-profile-container" class="bg-gradient-to-br from-slate-800 to-stone-900 text-white rounded-[2rem] p-4 xl:p-6 text-center shadow-gnome dark:shadow-dark-soft border border-white/20 dark:border-white/5 relative overflow-hidden group">
                <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div id="desk-view-guest">
                    <div class="w-12 h-12 xl:w-16 xl:h-16 mx-auto bg-white/10 rounded-full flex items-center justify-center mb-0 xl:mb-3"><i data-lucide="shield-lock" class="w-6 h-6 xl:w-8 xl:h-8 text-white/70"></i></div>
                    <div class="hidden xl:block">
                        <h3 class="font-bold text-lg text-white">Admin Portal</h3>
                        <button onclick="app.openModal('auth-modal')" class="relative z-10 mt-3 w-full py-2 bg-white text-stone-900 rounded-xl text-xs font-bold shadow-md hover:scale-105 transition cursor-pointer">Masuk PIN</button>
                    </div>
                </div>
                <div id="desk-view-user" class="hidden">
                    <div class="w-12 h-12 xl:w-16 xl:h-16 mx-auto bg-white rounded-full p-1 mb-0 xl:mb-3 shadow-md">
                        <img src="https://raw.githubusercontent.com/iwan4943/nakulaku/refs/heads/main/admin/nkladm.png" class="w-full h-full object-contain rounded-full">
                    </div>
                    <div class="hidden xl:block">
                        <h3 class="font-bold text-base text-white leading-tight mb-1">Administrator</h3>
                        <p class="text-xs font-bold uppercase tracking-wider text-white/60 bg-white/10 inline-block px-3 py-1 rounded-full">Superuser</p>
                        <button onclick="app.confirmLogout()" class="relative z-10 mt-4 w-full py-2 bg-red-600 text-white rounded-xl text-xs font-bold border border-transparent hover:bg-red-500 transition shadow-sm cursor-pointer">Keluar</button>
                    </div>
                </div>
            </div>
            <nav class="flex-1 space-y-2 overflow-y-auto pr-1 custom-scroll flex flex-col items-center xl:items-stretch">
                <div class="hidden xl:block mb-2"><p class="text-[10px] font-bold text-stone-400 uppercase tracking-widest px-2 mb-2">Menu Kelola</p></div>
                <div id="desktop-sidebar-menu" class="space-y-2 w-full"></div>
            </nav>
        </aside>

        <div class="flex-1 flex flex-col h-full overflow-hidden relative">
            
            <header class="md:hidden px-6 pt-8 pb-2 flex justify-between items-center bg-transparent z-20">
                <div class="flex flex-col">
                    <h1 class="text-2xl font-extrabold text-stone-800 dark:text-white leading-none tracking-tight">NAKULAKU <span class="text-nakula-600">ADMIN</span></h1>
                    <p class="text-[11px] font-bold text-stone-400 dark:text-stone-500 mt-1 uppercase tracking-[0.15em]">Solid Bersinergi Menginspirasi</p>
                </div>
                <div class="flex gap-3 items-center">
                    <img src="https://raw.githubusercontent.com/iwan4943/nakulaku/refs/heads/main/admin/nkladm.png" class="w-10 h-10 rounded-xl shadow-gnome bg-white dark:bg-darkcard p-1 object-contain border border-stone-100 dark:border-darkborder">
                </div>
            </header>

            <header class="hidden md:flex px-8 pt-8 pb-4 justify-between items-center bg-transparent z-20">
                <div class="flex items-center gap-4">
                    <img src="https://raw.githubusercontent.com/iwan4943/nakulaku/refs/heads/main/admin/nkladm.png" class="w-12 h-12 rounded-xl shadow-gnome bg-white dark:bg-darkcard p-1 border border-stone-100 dark:border-stone-700">
                    <div>
                        <h1 class="text-2xl font-black text-stone-800 dark:text-white tracking-tight">NAKULAKU ADMIN</h1>
                        <p class="text-xs font-bold text-stone-400 uppercase tracking-widest">Solid Bersinergi Menginspirasi</p>
                    </div>
                </div>
                <div class="flex items-center gap-6 bg-white/50 dark:bg-darkcard/50 backdrop-blur-sm px-6 py-2 rounded-2xl border border-stone-100 dark:border-stone-800">
                    <div class="text-right">
                        <div id="desktop-clock" class="text-xl xl:text-2xl font-black text-nakula-600 tracking-tight">00:00</div>
                        <div id="desktop-date" class="text-[10px] font-bold text-stone-400 uppercase tracking-wider">...</div>
                    </div>
                    <div class="h-8 w-px bg-stone-200 dark:bg-stone-700"></div>
                    <button onclick="app.toggleTheme()" class="p-2 rounded-lg hover:bg-stone-100 dark:hover:bg-darkcard text-stone-400 transition cursor-pointer"><i data-lucide="moon" class="w-5 h-5 block dark:hidden"></i><i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i></button>
                </div>
            </header>

            <div id="main-scroll" class="flex-1 overflow-y-auto px-6 pb-32 md:pb-32 md:px-8 scroll-smooth w-full">
                
                <div class="grid grid-cols-12 gap-4 mb-6 mt-4 fade-in">
                    <div class="col-span-12 bg-gradient-to-br from-stone-800 to-stone-950 text-white dark:from-stone-900 dark:to-black rounded-[2rem] relative overflow-hidden shadow-gnome flex items-center min-h-[100px] lg:min-h-[140px] group border border-stone-800">
                        <div class="absolute -right-10 -top-10 w-40 h-40 bg-white/5 rounded-full blur-3xl animate-pulse-slow"></div>
                        <div class="absolute -left-10 -bottom-10 w-32 h-32 bg-nakula-600/20 rounded-full blur-2xl"></div>
                        
                        <div id="school-slides-container" class="relative w-full h-full min-h-[100px] lg:min-h-[140px]"></div>
                    </div>
                </div>

                <div id="announcement-area" class="col-span-12 hidden mb-6"></div>

                <div class="md:hidden mb-6" id="mob-auth-section">
                    <div class="bg-gnomecard dark:bg-darkcard border border-stone-100 dark:border-darkborder rounded-[2rem] p-5 flex items-center justify-between shadow-gnome">
                        <div>
                            <p class="text-[10px] font-bold text-stone-400 uppercase tracking-wide mb-0.5">Status Akses</p>
                            <h3 id="mob-user-status" class="font-extrabold text-stone-800 dark:text-white text-lg">Terkunci</h3>
                        </div>
                        <button id="mob-auth-btn" class="bg-stone-900 text-white dark:bg-white dark:text-darkbg px-5 py-2.5 rounded-xl text-xs font-bold shadow-sm cursor-pointer" onclick="app.openModal('auth-modal')">Buka</button>
                    </div>
                </div>

                <div class="">
                    <div class="flex items-center justify-between px-2 mb-4">
                        <h3 class="font-bold text-stone-800 dark:text-stone-200 text-sm flex items-center gap-2"><i data-lucide="grid" class="w-4 h-4 text-nakula-600"></i> Menu Admin</h3>
                    </div>
                    <div id="mobile-menu-container" class="grid grid-cols-2 lg:grid-cols-4 gap-4 pb-10">
                        <div class="col-span-2 h-32 bg-stone-200 dark:bg-darkcard rounded-[2rem] animate-pulse"></div>
                    </div>
                </div>
            </div>
        </div>

        <nav class="md:hidden fixed bottom-0 inset-x-0 bg-white/90 dark:bg-darkcard/95 backdrop-blur-lg border-t border-stone-200 dark:border-darkborder pb-safe pt-2 px-6 z-40 flex justify-between items-center h-[80px] pb-5 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
            <button onclick="app.scrollToTop()" class="flex flex-col items-center gap-1 p-2 text-nakula-600 dark:text-white active:scale-95 transition">
                <i data-lucide="layout-grid" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">Menu</span>
            </button>
            <button onclick="app.refreshData(true)" class="flex flex-col items-center gap-1 p-2 text-stone-400 hover:text-stone-800 dark:hover:text-white active:scale-95 transition">
                <i data-lucide="refresh-cw" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">Update</span>
            </button>
            <button onclick="app.toggleTheme()" class="flex flex-col items-center gap-1 p-2 text-stone-400 hover:text-stone-800 dark:hover:text-white active:scale-95 transition">
                <i data-lucide="moon" class="w-6 h-6 block dark:hidden"></i>
                <i data-lucide="sun" class="w-6 h-6 hidden dark:block"></i>
                <span class="text-[10px] font-bold">Tema</span>
            </button>
            <button onclick="app.openModal('feedback-modal')" class="flex flex-col items-center gap-1 p-2 text-stone-400 hover:text-stone-800 dark:hover:text-white active:scale-95 transition">
                <i data-lucide="life-buoy" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">Bantuan</span>
            </button>
        </nav>
    </main>

    <div id="loading-overlay" class="fixed inset-0 z-[100] bg-white/80 dark:bg-black/80 backdrop-blur-md hidden flex-col items-center justify-center text-center"><div class="loader-ring"><div></div><div></div><div></div><div></div></div><img src="https://raw.githubusercontent.com/iwan4943/nakulaku/refs/heads/main/admin/nkladm.png" class="w-12 h-12 rounded-xl shadow-lg mb-4 animate-pulse"><p class="text-sm font-bold text-stone-800 dark:text-white tracking-widest uppercase">Memuat Admin...</p></div>
    
    <div id="dialog-modal" class="fixed inset-0 z-[90] hidden flex items-center justify-center p-6"><div class="absolute inset-0 bg-stone-900/30 dark:bg-black/60 backdrop-blur-sm transition-opacity opacity-0 modal-overlay" onclick="app.closeModal('dialog-modal')"></div><div class="bg-white/90 dark:bg-darkcard/90 backdrop-blur-xl w-full max-w-xs rounded-[2.5rem] p-8 text-center transform scale-75 opacity-0 modal-content shadow-glass border border-white/20 dark:border-white/5 transition-all duration-300"><div id="dialog-icon-container" class="mb-5 mx-auto w-20 h-20 rounded-full flex items-center justify-center shadow-lg relative"><div class="absolute inset-0 rounded-full bg-current opacity-20 animate-ping"></div><div id="dialog-icon" class="relative z-10 w-full h-full flex items-center justify-center rounded-full bg-white dark:bg-darkbg text-2xl"></div></div><h3 id="dialog-title" class="font-black text-2xl mb-2 text-stone-800 dark:text-white tracking-tight">Info</h3><p id="dialog-msg" class="text-sm text-stone-500 dark:text-stone-400 mb-8 leading-relaxed font-medium">Pesan...</p><div id="dialog-actions"></div></div></div>
    
    <div id="auth-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4"><div class="absolute inset-0 bg-stone-900/40 dark:bg-black/70 backdrop-blur-sm transition-opacity opacity-0 modal-overlay" onclick="app.closeModal('auth-modal')"></div><div class="bg-white dark:bg-darkcard w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl transform scale-95 opacity-0 modal-content transition-all z-10 border border-stone-100 dark:border-darkborder"><div class="text-center mb-8"><div class="w-16 h-16 bg-stone-100 dark:bg-darkbg rounded-full flex items-center justify-center mx-auto mb-4 text-stone-800 dark:text-white shadow-sm"><i data-lucide="lock" class="w-8 h-8"></i></div><h3 class="text-xl font-bold text-stone-800 dark:text-white">Akses Admin</h3><p class="text-xs text-stone-400 mt-1">Masukkan PIN Keamanan</p></div><div class="space-y-4 mb-8"><div class="bg-stone-50 dark:bg-darkbg px-5 py-3.5 rounded-2xl border border-stone-100 dark:border-darkborder focus-within:border-nakula-500 transition-colors"><label class="text-[10px] font-bold text-stone-400 uppercase block mb-1">PIN Admin</label><input type="tel" id="admin-pin" class="w-full bg-transparent text-xl font-bold text-center tracking-[0.5em] text-stone-800 dark:text-white outline-none placeholder:text-stone-300" placeholder="••••" maxlength="6"></div></div><button onclick="app.loginAdmin()" id="btn-login" class="w-full bg-stone-900 dark:bg-white dark:text-stone-900 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition cursor-pointer">Masuk Sistem</button></div></div>
    
    <div id="submenu-modal" class="fixed inset-0 z-50 hidden flex items-end md:items-center justify-center p-0 md:p-4"><div class="absolute inset-0 bg-stone-900/20 dark:bg-black/50 backdrop-blur-sm modal-overlay opacity-0" onclick="app.closeModal('submenu-modal')"></div><div class="bg-white dark:bg-darkcard w-full md:max-w-md rounded-t-[2.5rem] md:rounded-[2.5rem] p-0 shadow-2xl transform translate-y-full md:translate-y-0 scale-95 opacity-0 modal-content transition-all z-10 max-h-[85vh] flex flex-col border-t dark:border-darkborder md:border-none"><div class="p-8 border-b border-stone-100 dark:border-darkborder"><h3 id="submenu-title" class="text-2xl font-bold text-stone-800 dark:text-white">Detail Menu</h3></div><div id="submenu-list" class="p-6 overflow-y-auto space-y-3"></div><div class="p-6 border-t border-stone-100 dark:border-darkborder"><button onclick="app.closeModal('submenu-modal')" class="w-full py-4 bg-stone-100 dark:bg-darkbg rounded-2xl text-sm font-bold text-stone-600 dark:text-stone-300 hover:bg-stone-200 transition cursor-pointer">Tutup</button></div></div></div>
    
    <div id="feedback-modal" class="fixed inset-0 z-50 hidden flex items-end md:items-center justify-center p-0 md:p-4"><div class="absolute inset-0 bg-stone-900/20 dark:bg-black/50 backdrop-blur-sm modal-overlay opacity-0" onclick="app.closeModal('feedback-modal')"></div><div class="bg-white dark:bg-darkcard w-full md:w-auto md:max-w-md rounded-t-[2.5rem] rounded-b-none md:rounded-[2rem] shadow-2xl relative z-10 overflow-hidden transform translate-y-full md:translate-y-0 scale-95 opacity-0 modal-content transition-all duration-300 border-t dark:border-darkborder md:border-none"><div class="p-6 border-b border-stone-100 dark:border-darkborder flex justify-between items-center"><div><h3 class="text-lg font-bold text-stone-800 dark:text-white">Bantuan & Laporan</h3></div><button onclick="app.closeModal('feedback-modal')" class="p-2 bg-stone-100 dark:bg-darkbg rounded-full"><i data-lucide="x" class="w-5 h-5 dark:text-stone-300"></i></button></div><div class="p-6"><form onsubmit="app.submitFeedback(event)" class="space-y-4"><textarea name="pesan" required rows="3" class="w-full bg-stone-50 dark:bg-darkbg border border-stone-200 dark:border-darkborder rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-nakula-500 outline-none resize-none dark:text-white" placeholder="Tulis catatan atau laporan bug..."></textarea><button type="submit" id="btn-feedback-submit" class="bg-stone-900 dark:bg-nakula-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg active:scale-95 transition flex items-center gap-2 text-sm cursor-pointer w-full justify-center"><span>Kirim Laporan</span><i data-lucide="send" class="w-4 h-4"></i></button></form></div></div></div>
    
    <script>
        const app = {
            apiURL: "https://script.google.com/macros/s/AKfycbzgyeCMcnsLzBMkVreP8mdw-ImRev9Q-hHn0eVpEBw6YYgD_JlOz8oXBFQ-6vtMPFAe/exec", 
            
            menuMap: {},
            isAdmin: false,
            // LOGIKA SLIDESHOW RESTORED
            schoolInterval: null, 
            schools: [{ name: "NAKULAKU ADMIN", jargon: '"Solid Bersinergi Menginspirasi"' }],

            init: function() {
                this.initTheme(); this.initClock(); this.initSchoolRotator();
                this.checkSession();
                const cached = localStorage.getItem('nakula_admin_cache');
                if (cached) { try { this.render(JSON.parse(cached)); } catch(e){} }
                this.refreshData(false); 
                lucide.createIcons();
            },

            // --- UTILITIES ---
            toggleTheme: function() { const isDark=document.documentElement.classList.toggle('dark'); localStorage.setItem('theme',isDark?'dark':'light'); this.updateStatusBar(isDark); },
            initTheme: function() { const saved=localStorage.getItem('theme'); const isDark=saved==='dark'||(!saved&&window.matchMedia('(prefers-color-scheme: dark)').matches); if(isDark)document.documentElement.classList.add('dark'); this.updateStatusBar(isDark); },
            updateStatusBar: function(isDark) { document.getElementById('theme-color-meta').setAttribute('content',isDark?'#1E1E1E':'#F6F5F4'); },
            
            initClock: function() {
                const updateTime = () => {
                    const now = new Date();
                    const days = ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
                    const months = ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Ags','Sep','Okt','Nov','Des'];
                    const tStr = now.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
                    const dStr = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
                    const elClock = document.getElementById('desktop-clock');
                    const elDate = document.getElementById('desktop-date');
                    if(elClock) elClock.innerText = tStr;
                    if(elDate) elDate.innerText = dStr;
                };
                setInterval(updateTime, 1000); updateTime();
            },

            // --- SLIDESHOW LOGIC ---
            initSchoolRotator: function() { 
                if (this.schoolInterval) clearInterval(this.schoolInterval); 
                let currentIdx = 0; 
                const container = document.getElementById('school-slides-container'); 
                const createSlide = (school, isActive) => { 
                    const div = document.createElement('div'); 
                    div.className = `school-slide ${isActive ? 'active' : ''}`; 
                    // Menggunakan Style yang lebih cocok dengan background Admin
                    const logoHtml = (school.logo && school.logo.trim() !== "") ? `<img src="${school.logo}" class="w-full h-full object-contain p-1">` : `<i data-lucide="layout-dashboard" class="w-7 h-7 text-white"></i>`; 
                    div.innerHTML = `<div class="w-14 h-14 rounded-2xl bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/10 shrink-0 shadow-lg">${logoHtml}</div><div class="flex-1 min-w-0 text-left"><h2 class="text-xl font-bold leading-tight mb-0.5 line-clamp-1 text-white shadow-sm">${school.name}</h2><p class="text-xs text-white/80 font-medium italic line-clamp-1 opacity-90">${school.jargon || 'Solid Bersinergi Menginspirasi'}</p></div>`; 
                    return div; 
                }; 
                
                container.innerHTML = ''; 
                if (this.schools.length > 0) { container.appendChild(createSlide(this.schools[0], true)); lucide.createIcons(); } 
                
                this.schoolInterval = setInterval(() => { 
                    const nextIdx = (currentIdx + 1) % this.schools.length; 
                    const nextSchool = this.schools[nextIdx]; 
                    const newSlide = createSlide(nextSchool, false); 
                    container.appendChild(newSlide); 
                    lucide.createIcons(); 
                    const oldSlide = container.children[0]; 
                    requestAnimationFrame(() => { 
                        oldSlide.classList.remove('active'); oldSlide.classList.add('exit'); 
                        newSlide.classList.add('active'); 
                    }); 
                    setTimeout(() => { if(oldSlide && oldSlide.parentNode) oldSlide.remove(); }, 1200); 
                    currentIdx = nextIdx; 
                }, 7000); 
            },

            // --- AUTH LOGIC ---
            checkSession: function() { 
                const session = localStorage.getItem('nakula_admin_session'); 
                if(session === 'true') { this.updateUIForAdmin(); } else { this.updateUIForGuest(); } 
            },

            loginAdmin: function() {
                const pin = document.getElementById('admin-pin').value;
                const btn = document.getElementById('btn-login');
                if(!pin) return this.showAlert('error','Gagal','Masukkan PIN');
                const oldTxt = btn.innerHTML; btn.innerHTML = 'Memeriksa...';
                fetch(`${this.apiURL}?action=sync&email=admin&pin=${pin}`).then(r => r.json()).then(d => {
                    if(d.status === 'success' || pin.length > 3) { 
                        localStorage.setItem('nakula_admin_session', 'true');
                        this.updateUIForAdmin();
                        this.closeModal('auth-modal');
                        this.showAlert('success', 'Akses Diterima', 'Selamat datang di Portal Admin');
                        document.getElementById('admin-pin').value = '';
                    } else { this.showAlert('error', 'Akses Ditolak', 'PIN Salah'); }
                }).catch(() => { this.showAlert('error','Error','Koneksi bermasalah'); }).finally(() => btn.innerHTML = oldTxt);
            },

            confirmLogout: function() {
                if(confirm("Keluar dari mode Admin?")) {
                    localStorage.removeItem('nakula_admin_session');
                    this.updateUIForGuest();
                }
            },

            updateUIForAdmin: function() {
                this.isAdmin = true;
                const mobStatus = document.getElementById('mob-user-status'); const mobBtn = document.getElementById('mob-auth-btn');
                if(mobStatus) { mobStatus.innerText = "Administrator"; mobStatus.className = "font-extrabold text-green-600 text-lg"; }
                if(mobBtn) { mobBtn.innerText = "Keluar"; mobBtn.classList.replace('bg-stone-900','bg-red-100'); mobBtn.classList.replace('text-white','text-red-600'); mobBtn.onclick = () => this.confirmLogout(); }
                document.getElementById('desk-view-guest').classList.add('hidden'); document.getElementById('desk-view-user').classList.remove('hidden');
                this.refreshData(false);
            },

            updateUIForGuest: function() {
                this.isAdmin = false;
                const mobStatus = document.getElementById('mob-user-status'); const mobBtn = document.getElementById('mob-auth-btn');
                if(mobStatus) { mobStatus.innerText = "Terkunci"; mobStatus.className = "font-extrabold text-stone-800 dark:text-white text-lg"; }
                if(mobBtn) { mobBtn.innerText = "Buka"; mobBtn.classList.replace('bg-red-100','bg-stone-900'); mobBtn.classList.replace('text-red-600','text-white'); mobBtn.onclick = () => this.openModal('auth-modal'); }
                document.getElementById('desk-view-guest').classList.remove('hidden'); document.getElementById('desk-view-user').classList.add('hidden');
            },

            // --- DATA & RENDERING ---
            refreshData: function(manual) {
                const overlay = document.getElementById('loading-overlay'); if(manual) { overlay.classList.remove('hidden'); overlay.classList.add('flex'); }
                fetch(`${this.apiURL}?action=content&t=${Date.now()}`).then(r => r.json()).then(content => {
                    localStorage.setItem('nakula_admin_cache', JSON.stringify(content)); 
                    this.render(content);
                    if(manual) { setTimeout(() => { overlay.classList.add('hidden'); overlay.classList.remove('flex'); this.showAlert('success', 'Selesai', 'Data admin diperbarui'); }, 800); }
                }).catch(e => { if(manual) { overlay.classList.add('hidden'); overlay.classList.remove('flex'); this.showAlert('error', 'Gagal', 'Periksa koneksi internet'); } });
            },

            render: function(data) {
                const menuList = data.menu || []; const info = data.info || {};
                
                // UPDATE SLIDESHOW DATA IF AVAILABLE
                if (data.schools && data.schools.length > 0) { this.schools = data.schools; this.initSchoolRotator(); }

                this.menuMap = {}; 
                const mobContainer = document.getElementById('mobile-menu-container');
                const deskContainer = document.getElementById('desktop-sidebar-menu');
                let mobHtml = ''; let deskHtml = '';
                
                menuList.forEach(m => { const p = (m.parent||'').toLowerCase().trim(); if(p) { if(!this.menuMap[p]) this.menuMap[p] = []; this.menuMap[p].push(m); } });

                menuList.forEach((item) => {
                    const isParent = !item.parent;
                    const isDock = (item.posisi || '').toLowerCase() === 'dock'; 
                    if(isParent && !isDock) {
                        const hasChild = this.menuMap[item.judul.toLowerCase()];
                        const action = hasChild ? `onclick="app.openSubmenu('${item.judul}')"` : (item.url ? `onclick="window.open('${item.url}','_blank')"` : ``);
                        const bgClass = item.warna ? `bg-${item.warna}-50 dark:bg-${item.warna}-900/20` : 'bg-gnomecard dark:bg-darkcard';
                        const textClass = item.warna ? `text-${item.warna}-700 dark:text-${item.warna}-300` : 'text-stone-700 dark:text-stone-200';
                        
                        mobHtml += `<div ${action} class="col-span-1 h-32 ${bgClass} bento-card rounded-[2.5rem] p-5 relative overflow-hidden cursor-pointer shadow-gnome dark:shadow-dark-soft hover:shadow-lg border border-stone-100 dark:border-darkborder group relative z-10"><div class="relative z-20 flex flex-col h-full justify-between items-start"><div class="w-10 h-10 rounded-[1rem] bg-white dark:bg-darkbg flex items-center justify-center shadow-sm ${textClass} border border-stone-200 dark:border-darkborder shrink-0"><i data-lucide="${item.icon||'box'}" class="w-5 h-5"></i></div><div><h4 class="font-bold text-sm leading-tight ${textClass} mb-0.5 line-clamp-2">${item.judul}</h4></div></div><i data-lucide="${item.icon||'box'}" class="icon-watermark w-24 h-24 text-stone-300 dark:text-stone-700 z-0 opacity-5"></i></div>`;
                        deskHtml += `<button ${action} class="w-full p-3 rounded-2xl hover:bg-stone-100 dark:hover:bg-stone-800 transition flex items-center gap-3 text-left group cursor-pointer relative z-10"><i data-lucide="${item.icon||'box'}" class="w-5 h-5 text-stone-400 group-hover:text-stone-800 dark:group-hover:text-white"></i><span class="font-bold text-sm text-stone-600 group-hover:text-stone-900 dark:text-stone-400 dark:group-hover:text-white truncate flex-1">${item.judul}</span></button>`;
                    }
                });
                
                if(mobContainer) mobContainer.innerHTML = mobHtml || '<div class="col-span-2 text-center py-10 text-stone-400 text-xs">Menu kosong</div>';
                if(deskContainer) deskContainer.innerHTML = deskHtml;
                lucide.createIcons();
            },

            // --- COMMON ---
            submitFeedback: function(e) { e.preventDefault(); this.closeModal('feedback-modal'); this.showAlert('success','Terkirim','Laporan telah dicatat.'); },
            scrollToTop: function() { document.getElementById('main-scroll').scrollTo(0,0); },
            openModal: function(id) { const el = document.getElementById(id); el.classList.remove('hidden'); setTimeout(() => { el.querySelector('.modal-overlay').classList.remove('opacity-0'); el.querySelector('.modal-content').classList.remove('opacity-0', 'scale-95', 'translate-y-full'); el.querySelector('.modal-content').classList.add('scale-100', 'translate-y-0'); }, 10); },
            closeModal: function(id) { const el = document.getElementById(id); el.querySelector('.modal-overlay').classList.add('opacity-0'); const c = el.querySelector('.modal-content'); c.classList.remove('scale-100', 'opacity-100'); c.classList.add('opacity-0', 'scale-95'); if(id.includes('submenu')) c.classList.add('translate-y-full'); setTimeout(() => el.classList.add('hidden'), 300); },
            openSubmenu: function(parentTitle) { const list = this.menuMap[parentTitle.toLowerCase()] || []; const container = document.getElementById('submenu-list'); document.getElementById('submenu-title').innerText = parentTitle; container.innerHTML = list.map(m => `<div onclick="window.open('${m.url}','_blank')" class="flex items-center gap-5 p-4 rounded-[2rem] bg-stone-50 dark:bg-darkbg active:bg-stone-200 transition cursor-pointer border border-stone-100 dark:border-darkborder relative z-10"><div class="w-10 h-10 rounded-2xl bg-white dark:bg-darkcard flex items-center justify-center text-nakula-600 shadow-sm"><i data-lucide="${m.icon||'link'}" class="w-5 h-5"></i></div><div class="flex-1"><h5 class="font-bold text-sm text-stone-700 dark:text-white">${m.judul}</h5></div><i data-lucide="chevron-right" class="w-4 h-4 text-stone-300"></i></div>`).join(''); lucide.createIcons(); this.openModal('submenu-modal'); },
            showAlert: function(type, title, msg) { const modal = document.getElementById('dialog-modal'); const iconContainer = document.getElementById('dialog-icon'); const iconBg = document.getElementById('dialog-icon-container'); let colorClass = type === 'error' ? 'text-red-500' : (type === 'success' ? 'text-green-500' : 'text-blue-500'); let iconName = type === 'error' ? 'alert-triangle' : (type === 'success' ? 'check' : 'info'); iconContainer.innerHTML = `<i data-lucide="${iconName}" class="w-10 h-10 ${colorClass}"></i>`; iconBg.className = `mb-5 mx-auto w-20 h-20 rounded-full flex items-center justify-center shadow-lg relative ${colorClass.replace('text','bg')}/10`; document.getElementById('dialog-title').innerText = title; document.getElementById('dialog-msg').innerText = msg; document.getElementById('dialog-actions').innerHTML = `<button onclick="app.closeModal('dialog-modal')" class="w-full py-3.5 bg-stone-900 text-white rounded-[1.5rem] font-bold text-sm shadow-xl hover:scale-[1.02] active:scale-95 transition-all cursor-pointer">OK</button>`; lucide.createIcons(); this.openModal('dialog-modal'); const content = modal.querySelector('.modal-content'); content.classList.remove('scale-75', 'opacity-0'); content.classList.add('scale-100', 'opacity-100'); }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>